@model IEnumerable<AdminTool.Models.FactionVm>
@{
    ViewData["Title"] = "Factions";
    bool? isActive = ViewBag.FilterIsActive as bool?;
}

<h2 class="mb-3">Factions</h2>

@if (TempData["Message"] is string msg)
{
    <div class="alert alert-success">@msg</div>
}
@if (TempData["Error"] is string err)
{
    <div class="alert alert-danger">@err</div>
}

<div class="mb-3">
    <form id="filterForm" method="get" class="row g-2 align-items-end">
        <div class="col-auto">
            <label class="form-label">Is Active</label>
            <select name="isActive" class="form-select">
                <option value="" selected="@(isActive == null)">All</option>
                <option value="true" selected="@(isActive == true)">Active</option>
                <option value="false" selected="@(isActive == false)">Inactive</option>
            </select>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-outline-secondary">Filter</button>
            <a asp-action="Index" class="btn btn-outline-dark">Reset</a>
            <a asp-action="Create" class="btn btn-primary">Create</a>
        </div>
    </form>
</div>
<table class="table table-bordered align-middle">
    <thead class="table-light">
        <tr>
            <th style="width:80px;">ID</th>
            <th>Key</th>
            <th>Label</th>
            <th style="width:60px;">Icon</th>   <!-- 아이콘 열 추가 -->
            <th style="width:100px;">Color</th>
            <th class="text-end" style="width:120px;">Sort</th>
            <th style="width:110px;">Active</th>
            <th style="width:180px;"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var x in Model)
        {
            <tr>
                <td>@x.FactionId</td>
                <td class="text-monospace">@x.Key</td>
                <td>@x.Label</td>
                <td>
                    @if (!string.IsNullOrWhiteSpace(x.IconUrl))
                    {
                        <img src="@x.IconUrl" alt="icon" style="width:24px;height:24px;object-fit:contain;" />
                    }
                </td>
                <td>
                    @if (!string.IsNullOrWhiteSpace(x.ColorHex))
                    {
                        <span class="d-inline-flex align-items-center gap-2">
                            <span style="display:inline-block;width:18px;height:18px;border:1px solid #ccc;border-radius:4px;background:@x.ColorHex"></span>
                            <small>@x.ColorHex</small>
                        </span>
                    }
                </td>
                <td class="text-end">@x.SortOrder</td>
                <td>
                    @if (x.IsActive)
                    {
                        <span class="badge bg-success">Active</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">Inactive</span>
                    }
                </td>
                <td class="text-nowrap">
                    <a class="btn btn-sm btn-outline-primary" asp-action="Edit" asp-route-id="@x.FactionId">Edit</a>
                    <form asp-action="Delete" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@x.FactionId" />
                        <button type="submit" class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('삭제할까요?');">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>


@section Scripts {
<script>
  // 선택 즉시 필터 적용 (원하면 제거 가능)
  (function(){
    const f = document.getElementById('filterForm');
    const sel = f.querySelector('select[name="isActive"]');
    sel.addEventListener('change', () => f.submit());
  })();
</script>
}