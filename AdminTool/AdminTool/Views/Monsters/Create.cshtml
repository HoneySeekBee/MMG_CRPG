@model AdminTool.Models.MonsterEditVm

@{
    ViewData["Title"] = "Create Monster";
}

<h2>몬스터 등록</h2>

<form asp-action="Create" method="post" enctype="multipart/form-data">
    <div class="mb-3">
        <label asp-for="Name" class="form-label"></label>
        <input asp-for="Name" class="form-control" />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="ModelKey" class="form-label"></label>
        <input asp-for="ModelKey" class="form-control" />
        <span asp-validation-for="ModelKey" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="ElementId"></label>
        <select asp-for="ElementId" asp-items="Model.Elements" class="form-control">
            <option value="">-- 선택 --</option>
        </select>
        <span asp-validation-for="ElementId" class="text-danger"></span>
    </div>

    <!-- 초상화 선택 -->
    <div class="mb-3">
        <label class="form-label">초상화 선택</label>
        <input type="hidden" asp-for="PortraitId" id="PortraitId" />

        <div id="portrait-scroll" class="portrait-scroll">
            <div class="row row-cols-auto g-2">
                @if (Model.PortraitChoices != null && Model.PortraitChoices.Any())
                {
                    foreach (var p in Model.PortraitChoices)
                    {
                        var isSelected = Model.PortraitId == p.PortraitId;
                        <div class="col">
                            <div class="portrait-option @(isSelected ? "selected" : "")"
                                 data-id="@p.PortraitId"
                                 data-url="@p.Url">
                                <img src="@p.Url" alt="@p.Key" />
                                <div class="portrait-name">@p.Key</div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-muted">불러올 초상화가 없습니다.</div>
                }
            </div>
        </div>

        <small class="text-muted d-block mt-1">이미지를 클릭하면 선택됩니다.</small>
    </div>
    <div class="mt-4">
        <button type="submit" class="btn btn-success">등록</button>
        <a asp-action="Index" class="btn btn-secondary">목록으로</a>
    </div>
</form>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const items = document.querySelectorAll('.portrait-option');
            const hidden = document.getElementById('PortraitId');

            items.forEach(item => {
                item.addEventListener('click', () => {
                    items.forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    hidden.value = item.getAttribute('data-id');
                });
            });
        });
    </script>
}